<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Address Caching System</title>
    <script src="/ksp_mono/public/assets/js/address-cache.js"></script>
</head>
<body>
    <h1>ğŸ§ª Address Caching System Test</h1>
    <div id="results"></div>

    <script>
        async function runCacheTests() {
            const resultsDiv = document.getElementById('results');
            let output = '';

            try {
                // Test 1: Cache statistics
                output += '<h2>ğŸ“Š Cache Statistics</h2>';
                const stats = window.AddressCache.getCacheStats();
                output += '<pre>' + JSON.stringify(stats, null, 2) + '</pre>';

                // Test 2: Load provinces (should use cache or fetch)
                output += '<h2>ğŸ›ï¸ Loading Provinces</h2>';
                const startTime = Date.now();
                const provinces = await window.AddressCache.getData('provinsi');
                const endTime = Date.now();
                output += `âœ… Loaded ${provinces.length} provinces in ${endTime - startTime}ms<br>`;

                if (provinces.length > 0) {
                    output += `First province: ${provinces[0].name}<br>`;

                    // Test 3: Load regencies for first province
                    output += '<h2>ğŸ¢ Loading Regencies</h2>';
                    const regencies = await window.AddressCache.getData('kabkota', provinces[0].id);
                    output += `âœ… Loaded ${regencies.length} regencies for ${provinces[0].name}<br>`;

                    if (regencies.length > 0) {
                        // Test 4: Load districts for first regency
                        output += '<h2>ğŸ˜ï¸ Loading Districts</h2>';
                        const districts = await window.AddressCache.getData('kecamatan', regencies[0].id);
                        output += `âœ… Loaded ${districts.length} districts for ${regencies[0].name}<br>`;
                    }
                }

                // Test 5: Force refresh
                output += '<h2>ğŸ”„ Force Refresh Test</h2>';
                const refreshStart = Date.now();
                const refreshedProvinces = await window.AddressCache.getData('provinsi', null, { forceRefresh: true });
                const refreshEnd = Date.now();
                output += `âœ… Force refreshed ${refreshedProvinces.length} provinces in ${refreshEnd - refreshStart}ms<br>`;

                // Test 6: Cache clearing
                output += '<h2>ğŸ§¹ Cache Clearing</h2>';
                window.AddressCache.clearCache('provinsi');
                output += 'âœ… Cleared provinces cache<br>';

                // Test 7: Check cache stats after clearing
                output += '<h2>ğŸ“Š Cache Stats After Clearing</h2>';
                const newStats = window.AddressCache.getCacheStats();
                output += '<pre>' + JSON.stringify(newStats.provinsi, null, 2) + '</pre>';

                output += '<h2>ğŸ‰ All Tests Completed Successfully!</h2>';

            } catch (error) {
                output += `<h2 style="color: red;">âŒ Test Failed</h2>`;
                output += `<p>Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }

            resultsDiv.innerHTML = output;
        }

        // Run tests when page loads
        window.addEventListener('load', runCacheTests);
    </script>
</body>
</html>
